services:
  opencode-telegram-bot:
    build:
      context: .
      dockerfile: Dockerfile
    restart: unless-stopped
    environment:
      # Required
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - TELEGRAM_ALLOWED_USER_ID=${TELEGRAM_ALLOWED_USER_ID}
      - OPENCODE_MODEL_PROVIDER=${OPENCODE_MODEL_PROVIDER}
      - OPENCODE_MODEL_ID=${OPENCODE_MODEL_ID}
      # OpenCode server â€” point to the host machine where OpenCode runs
      - OPENCODE_API_URL=${OPENCODE_API_URL:-http://host.docker.internal:4096}
      # Optional
      - OPENCODE_SERVER_USERNAME=${OPENCODE_SERVER_USERNAME:-opencode}
      - OPENCODE_SERVER_PASSWORD=${OPENCODE_SERVER_PASSWORD:-}
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - BOT_LOCALE=${BOT_LOCALE:-en}
      - SESSIONS_LIST_LIMIT=${SESSIONS_LIST_LIMIT:-10}
      - SHOW_THINKING=${SHOW_THINKING:-true}
      - SHOW_TOOL_EVENTS=${SHOW_TOOL_EVENTS:-true}
    volumes:
      # Persist settings.json across container restarts
      - bot_data:/app/.config
    extra_hosts:
      # Allow the container to reach the host machine (where OpenCode runs)
      - "host.docker.internal:host-gateway"

volumes:
  bot_data:
